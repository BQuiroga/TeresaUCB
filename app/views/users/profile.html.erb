

<div class="container-fluid" style="padding: 30px">
  <div id="container-cover">
    <div class="hovereffect"  >
				<%= image_tag("Cochabamba2016.jpg") %>
          <div class="overlay">
            <h2>Actualizar foto de portada</h2>
            <span class="glyphicon glyphicon-camera"></span>
          </div>
    </div>
  </div>
</div>
    <!-- FOTO AVATAR -->
	<div id="container-avatar">
	  <div class="hovereffect" id="avatar" >
      <%if @picture!=nil%>
        <%= link_to image_tag(@picture.image.url, class: 'media-object',style:"width:150px;height:150px"), @picture.image.url, target: '_blank' %>
      <%else%>
        <%= image_tag ("missing.png"),id:"botonsio"%>
      <%end%>
	        <div class="overlay"  >
	          <h2 >Actualizar foto de perfil</h2>
	          <label ><span class="glyphicon glyphicon-camera" id="overlay"></span></label>
	        </div>
	  </div>
	</div>





<!-- MODAL PARA FOTO?  -->

<div id="editProfileAvatar" class="modal" >
    <div class="modal-content" style="width:70%">
      <%if  @picture%>
      <%= form_for @picture, html: { multipart: true } do |f| %>
        <span class="close" id="close">&times;</span>
        <div class="header">
          <h3>Editar foto de perfil</h3>
        </div>
        <div class="col-md-2">
          <div class="thumbnail">
            <%= link_to image_tag(@picture.image.url, class: 'media-object '), @picture.image.url, target: '_blank' %>
            <br><br><br><br><br><br>
          </div>
        </div>
        <div class="col-md-2">
        </div>
        <div class="container">
          <div id="avatar_preview" style="display:none" class="col-md-2 "><img id="avatarPreview" src=""></div>
          <!-- <input id="avatarFile" name="avatarFile" type="file" class="file" alt="" /> -->
          <div class="col-md-2">
          </div>
          <div class="col-md-1">
            <%=f.file_field :image, :id=>"avatarFile"%>
          </div>
          <h4 id='loading' style="display:none">Subiendo..</h4>
          <div id="message"></div>
        </div>
        <%f.hidden_field :user_id, :value=>current_user.id%>
        <div class="actions">
          <%= f.submit 'Guardar', class: 'btn btn-success'%>
        </div>
        <%end%>
      <%else%>
      <%= form_for '/photos/new', html: { multipart: true } do |f| %>
        <span class="close" id="close">&times;</span>
        <div class="header">
          <h3>Subir foto de perfil</h3>
        </div>
        <div class="col-md-2">
          <div class="thumbnail">
            <%=image_tag("missing.png", class: 'media-object ') %>
            <br><br><br><br><br><br>
          </div>
        </div>
        <div class="col-md-2">
        </div>
        <div class="container">
          <div id="avatar_preview" style="display:none" class="col-md-2 "><img id="avatarPreview" src=""></div>
          <!-- <input id="avatarFile" name="avatarFile" type="file" class="file" alt="" /> -->
          <div class="col-md-2">
          </div>
          <div class="col-md-1">
            <%=f.file_field :image, :id=>"avatarFile"%>
          </div>
          <h4 id='loading' style="display:none">Subiendo..</h4>
          <div id="message"></div>
        </div>
        <%f.hidden_field :user_id, :value=>current_user.id%>
        <div class="actions">
          <%= f.submit 'Guardar', class: 'btn btn-success'%>
        </div>

      <%end%>

    <%end%>
  </div>
    <br/>
    <br>


</div>




  <script>
  var btn= document.getElementById("container-avatar")
  var modal = document.getElementById("editProfileAvatar");
  var span =document.getElementById("close");
  var botoncio=document.getElementById("botonsio");
  // var btns=document.getElementById("aceptar");
  // span.onclick = function() {
  //     modal.style.display = "none";
  // };
  btn.onclick =function(){
    modal.style.display ="block";
  };

  botoncio.onclick =function(){
    modal.style.display ="block";
  };
  // btn-s.onclick =function(){
  //   window.location.href="/users/profile"
  // };
  $(document).ready(function (e) {
  $("#avatarFile").change(function () {
      $("#message").empty();
      var file = this.files[0];
      var imagefile = file.type;
      var match = ["image/jpeg", "image/png", "image/jpg", "image/gif"];
      if (!((imagefile == match[0]) || (imagefile == match[1]) || (imagefile == match[2]) || (imagefile == match[3]))) {
          $('#previewing').attr('src', 'noimage.png');
          $("#message").html("<p id='error'>Por favor seleccione un archivo de imagen v√°lido.</p><span id='error_message'> Los tipos soportados son: jpg, gif y png.</span>");
          return false;
      }
      else {
          var reader = new FileReader();
          reader.onload = imageIsLoaded;
          reader.readAsDataURL(this.files[0]);
      }
  });

  function imageIsLoaded(e) {
      $("#avatarFile").css("color", "green");
      $('#avatar_preview').css("display", "block");
      $('#avatarPreview').attr('src', e.target.result);
      $('#avatarPreview').attr('width', '230px');
      $('#avatarPreview').attr('height', '210px');
  };
});

  </script>


	<div class="container-fluid">
		<div class="row ">
		 <div class="col-md-2 col-sm-3">
    		<div class="contenedor-enlaces">
      		<%if current_user.is_company?%>
      	<%= link_to '<span class="glyphicon glyphicon-pencil"></span> Crear oferta'.html_safe,'/oferta/nueva' ,class: 'enlaces-perfil'%>
        <%= link_to '<span class="glyphicon glyphicon-envelope"></span> Notificaciones'.html_safe,'/mis_notificaciones' ,class: 'enlaces-perfil'%>
        <%else%>
        <%= link_to '<span class="glyphicon glyphicon-briefcase"></span> Ver Curriculum'.html_safe,  '/mycurriculum',class: 'enlaces-perfil'%>
        <%= link_to '<span class="glyphicon glyphicon-pencil"></span> Editar Curriculum'.html_safe,'/users/curriculum/edit' ,class: 'enlaces-perfil'%>
      	<%end%>
        <%= link_to '<span class="glyphicon glyphicon-briefcase"></span> Mis Grupos'.html_safe, '/grupos/mis_grupos', class: 'enlaces-perfil'%>
    	 </div>
  	 </div>
		 <br><br>
     <div class="col-md-6 col-sm-6">
	     <%= form_for :post, url: '/posts/new' do |f| %>
	      <div class="row">
		      <div class="col-md-12">
      			<%= f.text_area(:body, class: "form-control estado", placeholder: 'Como te sientes?', rows: 3 ,id:'estado',maxlength: 1000) %>
      			<%=f.hidden_field :user_id, :value => current_user.id%>
            <%=f.hidden_field :requiring,:value=>false%>
		      </div>
	      </div>
      	<div class="row barra-enviar">
      		<div class="col-md-9 col-sm-8 col-xs-4">
      			<label for="post_image">
              <!-- <span class="glyphicon glyphicon-camera btn btn-primary" aria-hidden="true"></span> -->
            </label>
      		</div>
      		<div class="col-md-3  col-sm-4  col-xs-8 cont-btn-publicar">
      			<button type="submit" class="btn btn-primary" id="boton_estado">
      				Publicar <span class="glyphicon glyphicon-bullhorn" aria-hidden="true"></span>
      			</button>
      		</div>
      	</div>
	     <% end %>
      <br><br>
    <%if (@posts)%>
    	<% @posts.each do |post| %>
        <div class="bs-callout bs-callout-danger"style="background-color: #D8D8D8">
          <%= link_to '<button class="glyphicon glyphicon-pencil pull-right "></button>'.html_safe, edit_post_path(post) %>
          <h5><%= post.user_name %></h5>
          <p class="format-text">
            <% post.body.split("\n").each do |line|  %>
              <%=line%><br>
            <%end%>
          </p>
        	<!-- <button type="button" class="btn btn-primary" aria-label="Left Align">
            <span class=" glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
        	</button>
        	<button type="button" class="btn btn-warning" aria-label="Left Align">
          	<span class=" glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>
          </button> -->

          <%if current_user.not_me(post.user.id) and (Follow.where(follower:current_user.id,followed:post.user.id).size==0) and !current_user.is_my_friend(post.user.id)and post.user.is_company?%>
            <%= form_for :follow, url: '/follows/new' do |f| %>
              <%=f.hidden_field :follower, :value => current_user.id%>
              <%=f.hidden_field :followed, :value => post.user.id%>
        	    <button type="button submit" class="btn btn-default" aria-label="Left Align">
           	    Seguir
        	    </button>
            <%end%>
          <%else%>
            <%if (Follow.where(follower:current_user.id,followed:post.user.id).size!=0) and post.user.is_company?%>
              <button type="button submit" class="btn btn-default" aria-label="Left Align">
                <%=link_to "Dejar de seguir", {controller: "follows", action: "dejar", id: Follow.where(follower.current_user.id,followed:post.user.id).first.id}%>
              </button>
            <%end%>
          <%end%>
          <%if (!current_user.is_my_friend(post.user.id))%>
            <%if current_user.not_me(post.user.id) and !post.user.is_company?%>
              <button type="button submit" class="btn btn-default" aria-label="Left Align">
                <%=link_to "Agregar a mis amigos", {controller: "friendships", action: "friend", id: post.user.id}%>
              </button>
            <%end%>
          <%else%>
          <%if current_user.not_me(post.user.id) and !post.user.is_company?%>
            <button type="button submit" class="btn btn-default" aria-label="Left Align">
              <%=link_to "Dejar de ser amigos", {controller: "friendships", action: "notmine", id: post.user.id}%>
            </button>
          <%end%>
          <%end%>
            <%if current_user.not_me(post.user.id) and post.user.is_company?%>
              <a href="/mis_notificaciones/new/<%=post.id%>">
               <button type="button" class="btn btn-default" aria-label="Left Align">Postular</button>
              </a>
            <%end%>
          </div>
    	 <%end%>
      <%end%>
    </div>

<div class="pull-right col-md-4 col-sm-3 right-group-menu" style="right:0px" id="group_menu">
  <div class="panel panel-default">
    <div class="panel-heading"><div class="panel-title"><h3>Mis Grupos </h3></div></div>
    <div class="panel-body">
    <% if @groups.size >0%>
    <ul class="list-group">
    <% @groups.each do |group| %>
      <li class="list-group-item">
        <div>
          <h4>  <b><%=group.name%>&emsp;</b>
            <a href="/grupos/<%=group.id%>/miembros">
              <button class="btn btn-default btn-sm pull-right">Ver Miembros</button>
            </a>

            <button class="btn btn-warning btn-sm pull-right">
                  <%if current_user.is_my_group(group.id)%>
                    <%=link_to "Borrar grupo", {controller: "groups",action:"abandonar",id:group.id}%>
                  <%else%>
                    <%if current_user.is_in_this_group(group)%>
                      <%=link_to "Salir", {controller: "groups",action:"abandonar",id:group.id}%>
                    <%else%>
                      <%=link_to "Unirme",{ controller: "groups",action:"unirme",id:group.id}%>
                    <%end%>
                  <%end%>
            </button>
          </h4>
          <%=group.description%>&nbsp;
          <%=group.members%>
        </div>
      </li>
        <%end%>
     <%end%>
   </ul>
   </div>
   </div>
  </div>

<br>

</div>
</div>
<br>
<script type="text/javascript">
$(document).ready(function(){
    $('#boton_estado').attr('disabled',true);
    $('#estado').keyup(function(){
        if($(this).val().length !=0)
          $('#boton_estado').attr('disabled', false);
        else
            $('#boton_estado').attr('disabled',true);
    })
});
</script>
<style>
.close {
    color: #aaa;
    float: right;
    font-size: 45px;
    font-weight: bold;
}
@media (max-width:600px){
  #group_menu{
    display:none;
  }
  #side_menu{

  }
}

</style>




  <!-- nav bar -->

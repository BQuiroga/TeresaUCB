<div class="container">
  <a href="/reportes"><button class="btn btn-primary" style="margin-top:50px">Volver Atras</button></a>
  <button id="myBtn" style="display:none">Open Modal</button>

  <div id="myModal" class="modal" >
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="myModal2" class="full reveal" data-reveal>
      </div>
    </div>
  </div>
<h1>Lista de reportes</h1>
  <div class="panel panel-primary">
    <div class="panel-heading"><div class="panel-title"style="padding-top:1px;padding-bottom:1px"><h3 style="margin-top:10px">Empresas clasificadas por código CIUU</h3></div></div>
      <div class="panel-body">
        <ul class="list-group">
          <li class="list-group-item">
              <div >
                  <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover" id="tabla">
                      <tr>
                        <th style="text-align: center;">&nbsp;Categoría según código CIUU &nbsp;</th>
                        <th style="text-align: center;">&nbsp;Número de empresas registradas&nbsp;</th>
                      </tr>
                      <% @companies_names.each do |date|%>
                        <tr>
                          <td>&nbsp;<%=date[0]%>&nbsp;</td>
                          <td style="text-align: center;"><%= date[1]%></td>
                        </tr>
                        <%end%>
                      </table>
                    </div>
              </div>
              <button class="btn btn-default btn-sm pull-right" id="mostrarEmpresasC" onclick="showEmpresasC()" style="display:none;">Mostrar Gráfica Estadística</button>
              <button class="btn btn-default btn-sm pull-right" id="ocultarEmpresasC" onclick="showEmpresasC()">Ocultar Gráfica Estadística</button>
              <br><br><br>
            </li>
            <li class="list-group-item">
              <div id="by_ciu">
                <%= column_chart @companies_names,stacked:true ,download:'grafica'%>
              </div>
            </li>
            <% @companies_names.each do |ciu| %>
            <li id="empresas_<%=ciu[0]%>" class="list-group-item lista-persona" >
              <div class="table table-responsive">
                <table  class="table table-striped table-bordered" style="text-align: center;" >
                  <tr>
                    <th style="text-align: center;">&nbsp;Nombre Empresa&nbsp;</th>
                    <th style="text-align: center;">&nbsp;Nombre Contacto&nbsp;</th>
                    <th style="text-align: center;">&nbsp;Correo electrónico contacto &nbsp;</th>
                    <th style="text-align: center;">&nbsp;Teléfono &nbsp;</th>
                    <th></th>
                  </tr>

                <%  @company_info.users_for(ciu).each do |user|%>
                <tr>
                  <td><%=user.name%></td>
                  <td><%=user.contact_name%></td>
                  <td><%=user.company_information.contact_email%></td>
                  <td><%=user.phone%></td>
                  <td>
                    <button class="btn btn-default btn-sm pull-right botonCV" value="<%=user.id%>">
                      Ver Información
                      <!-- <%=link_to "Ver Información", {controller: "resumes",action:"company_info",id:user.id},:popup => ['']%> -->

                    </button>
                  </td>
                </tr>
                <%end%>
              </table>
            </div>
            </li>
            <%end%>
        </ul>
      </div>
    </div>
  </div>

<script>

  var modal = document.getElementById('myModal');
  var btn = document.getElementById("myBtn");
  var span = document.getElementsByClassName("close")[0];
  btn.onclick = function() {
      modal.style.display = "block";
  }
  span.onclick = function() {
      modal.style.display = "none";
  }
  window.onclick = function(event) {
      if (event.target == modal) {
          modal.style.display = "none";
      }
  }
  $(".botonCV").on("click",function(e) {
    // e.preventDefault();
      var value= "http://localhost:3000/usuarios/curriculums/" +$(this).val();
    $('#myModal').show();
    $('#myModal2').load(value);
  });


var empresasC = document.getElementById("by_ciu");
var botonOcultarEC = document.getElementById("ocultarEmpresasC");
var botonMostrarEC = document.getElementById("mostrarEmpresasC");
window.onload =function(){
  botonMostrarEC.style.display="block";
  botonOcultarEC.style.display="none";
  empresasC.style.display="none";
}
function showEmpresasC() {
    if (empresasC.style.display === "none") {
        empresasC.style.display = "block";
        botonMostrarEC.style.display="none";
        botonOcultarEC.style.display="block";
    } else {
        empresasC.style.display = "none";
        botonMostrarEC.style.display="block";
        botonOcultarEC.style.display="none";
    }
}
$('#tabla td').click(function () {
  var opcion=$(this).parent("tr").find("td:first").text().substr(1).slice(0, -1);
  var listas=document.getElementsByClassName("lista-persona");
  for (var i=0; i<listas.length;i++)
  {
    if (listas[i].id=="empresas_"+opcion)
    {
      listas[i].style="display:block";
    }
    else
    {
      listas[i].style="display:none;"
    }
  }
});
</script>
<style>
    .lista-persona{
      display:none;
    }
  table.table-hover  td{
      cursor: pointer;
    }

      .modal {
          display: none; /* Hidden by default */
          position: fixed; /* Stay in place */
          z-index: 1; /* Sit on top */
          left: 0;
          top: -160px;
          width: 100%; /* Full width */
          height: 120; /* Full hei ght */
          overflow: auto; /* Enable scroll if needed */
          background-color: rgb(0,0,0); /* Fallback color */
          background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
      }
</style>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>


<a href="/reportes"><button class="btn btn-primary">Volver Atras</button></a>
<div class="container">
  <h2>Lista de reportes
    <%= link_to "Descargar Excel", reporte_nuevo_path(format: "xls") ,:class=>"btn btn-default pull-right"%>
  </h2>

  <button id="myBtn" style="display:none">Open Modal</button>

  <!-- The Modal -->
  <div id="myModal" class="modal">
    <!-- Modal content -->
    <div class="modal-content">
      <span class="close">&times;</span>
      <div id="myModal2" class="full reveal" data-reveal>
      </div>
    </div>

  </div>
  <div class="panel panel-default">
    <div class="panel-heading"><div class="panel-title"><h3>Resumen </h3></div></div>
    <div class="panel-body">
      <ul class="list-group">
        <li class="list-group-item">
          <div>
              <div class="table-responsive">
                <table  class="table table-striped table-bordered table-hover" id="table_report">
                  <tr>
                    <th style="text-align: center;">&nbsp;Titulo&nbsp;</th>
                    <th style="text-align: center;">&nbsp;Estudiantes egresados &nbsp;</th>
                  </tr>
                  <% @data_graphic.each do |user|%>
                  <tr>
                    <td ><%=user[0]%></td>
                    <td><%=user[1]%></td>
                  </tr>
                  <%end%>
                </table>
            </div>
          </div>
          <button class="btn btn-default btn-sm pull-right" id="mostrarFecha" onclick="showFecha()" style="display:none; ">Mostrar Gráfica Estadística</button>
          <button class="btn btn-default btn-sm pull-right" id="ocultarFecha" onclick="showFecha()">Ocultar Gráfica Estadística</button>
          <br><br>
        </li>
        <li class="list-group-item" id="lista_usuarios" style="display:none;">
            <div class="table table-responsive">
              <table  class="table table-striped table-bordered" style="text-align: center;">
                <tr>
                  <th style="text-align: center;">&nbsp;Nombre&nbsp;</th>
                  <th style="text-align: center;">&nbsp;Correo electronico &nbsp;</th>
                  <th style="text-align: center;">&nbsp;Telefono &nbsp;</th>
                  <th></th>
                </tr>
                <% @users.each do |user|%>
                  <tr>
                    <td><%=user.name%></td>
                    <td><%=user.email%></td>
                    <td><%=user.phone%></td>
                    <td>
                      <button class="btn btn-default btn-sm pull-right botonCV" value="<%=user.id%>">
                        Ver Curriculum
                        <!-- <%=link_to "Ver Curriculum", {controller: "resumes",action:"external_show",id:user.id},:popup => ['']%> -->

                      </button>
                    </td>
                  </tr>
                <%end%>
              </table>
            </div>
        </li>
        <li class="list-group-item">
          <div id="by_date">
          <%@data_graphic_to_chart=@data_graphic%>
          <%@total =@data_graphic_to_chart.sum{|x,y| @data_graphic_to_chart[x]}%>
          <%@data_graphic_to_chart=@data_graphic_to_chart.each{|x,y| @data_graphic_to_chart[x]=y.to_f/@total*100}%>
          <%@data_graphic_to_chart=@data_graphic_to_chart.each{|x,y| @data_graphic_to_chart[x]=y.to_s.first(5)+"%"}%>
            <%= bar_chart @data_graphic_to_chart, stacked: true, donwload: true%>
            <p style="text-align: center;">Los datos mostrados en la grafica se encuentran en %</p>
          </div>
        </li>
      </ul>
    </div>
  </div>
</div>


<script>
var modal = document.getElementById('myModal');
var btn = document.getElementById("myBtn");
var span = document.getElementsByClassName("close")[0];
btn.onclick = function() {
    modal.style.display = "block";
}
span.onclick = function() {
    modal.style.display = "none";
}
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}
$(".botonCV").on("click",function(e) {
  // e.preventDefault();
    var value= "http://localhost:3000/usuarios/curriculums/" +$(this).val();
  $('#myModal').show();
  $('#myModal2').load(value);
});

</script>

<script>
  var fecha = document.getElementById("by_date");
  var botonOcultarF = document.getElementById("ocultarFecha");
  var botonMostrarF = document.getElementById("mostrarFecha");
  window.onload =function(){
    botonMostrarF.style.display="block";
    botonOcultarF.style.display="none";
    fecha.style.display="none";
  }
  function showFecha() {
    if (fecha.style.display === "none") {
      fecha.style.display = "block";
      botonMostrarF.style.display="none";
      botonOcultarF.style.display="block";
    } else {
      fecha.style.display = "none";
      botonMostrarF.style.display="block";
      botonOcultarF.style.display="none";
    }
  }

  $('#table_report tr').click(function(){
  // alert( $('tr').index(this) + $('tr').val(this)[0]);
  showUsers();
  });
  function showUsers(){
    var lista=document.getElementById("lista_usuarios");
    if (lista.style.display=="none")
      lista.style.display="block";
    else
      lista.style.display="none";
  }
</script>

<style>
/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    left: 0;
    top: -160px;
    width: 100%; /* Full width */
    height: 120; /* Full hei ght */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}

/* Modal Content/Box */
.modal-content {
    background-color: #fefefe;
    margin: 20% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 80%; /* Could be more or less, depending on screen size */
}

/* The Close Button */
.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
</style>
